# Index란 무엇인가?

### Index
- 데이터베이스에서 빠른 검색을 가능하게 해주는 데이터 구조
- 책의 목차 또는 색인이라 생각 할 수 있다.
- 장점
    - 빠른 검색 : 데이터를 빠르게 찾을 수 있음
    - 정렬 및 그룹화 : 데이터 정렬, 그룹화 작업을 수행이 좋음
- 단점
    - 추가 저장 공간 필요
    - 갱신 : 데이터 변경시 index 갱신 또한 필요

### 동작 방식

![db_indxt.png](img/db_indxt.png)

1. Index 생성
- 데이터베이스에서 실제 데이터 레코드를 더 빠르게 찾기 위해, `데이터 레코드를 참조하는 인덱스를 만들고 '정렬'하여 데이터의 탐색을 더 빠르게 합니다.`
- 포인터 : 인덱스는 특정 컬럼에 대한 포인터를 포함하고 있으며, 포인터들은 데이터가 저장된 위치를 가리킵니다. 이를 통해 데이터베이스는 테이블을 Full Scan 하지 않고, 필요한 데이터를 찾을 수 있습니다.

2. 수정
- 데이터 삽입, 삭제, 수정 시 index 키에 영향을 미치면 기존 index 엔트리가 삭제되고, 새로운 index 엔트리가 생성 됩니다.

### Index의 자료구조
#### 해시 테이블
해시 테이블은 (Key, Value)로 데이터를 저장하는 자료구조로 빠른 데이터 검색이 필요할 때 유용합니다. 해시 테이블은 Key값을 이용해 고유한 index를 생성하여 그 index에 저장된 값을 꺼내오는 구조입니다.

![db_hash_table.png](img/db_hash_table.png)

DB index는 (데이터=컬럼의 값, 데이터의 위치)를 Key, Value로 사용하여 컬럼의 값으로 생성된 해시를 통해 index를 구현합니다. 해시 테이블의 시간 복잡도는 O(1)이며 빠른 검색을 지원합니다.
하지만 DB index에서 해시 테이블 사용은 제한적인데, 이유는 해시가 등호(=) 연산에만 특화되었기 때문입니다. 해시 함수는 값이 1이라도 다르면 완전히 다른 해시 값을 생성하는데, 이러한 특성 때문에 `부등호 연산이 자주 사용되는
DB 검색을 위해서는 해시 테이블이 적합하지 않습니다.`

즉, "나는"으로 시작하는 모든 데이터를 검색하기 위한 쿼리문은 index의 혜택을 전혀 받지 못합니다. 이러한 이유로 DB의 index에서는 B+Tree가 일반적으로 사용됩니다.

#### B-Tree
![B-Tree.png](img/B-Tree.png)
- 균형 잡힌 트리 구조로 데이터베이스와 파일 시스템에서 대량의 데이터를 관리하고 검색에 사용
- 특징
  - 다중 자식 노드 : 각 노드는 여러 개의 키, 자식을 가짐
  - 정렬된 노드 : 각 노드 내의 키들은 정렬된 상태로 유지
  - 균형 유지 : 모든 리프 노드는 동일한 깊이에 위치
  - 동적 데이터 관리 : 데이터 삽입, 삭제 시 트리 균형 자동 조정
- 장점
  - 빠른 검색과 정렬 지원
  - 효율적인 검색 기능
  - 균형 유지
  - 범위 검색에 유리
- 단점
  - 복잡한 구현
  - 공간 낭비 가능성
  - 데이터 재구성 필요

#### B+Tree
![B+Tree.png](img/B+Tree.png)
- DB index를 위해 자식 노드가 2개 이상인 B-Tree를 개선시킨 자료구조 입니다. B+Tree는 모든 노드에 데이터를 저장했던 B-Tree와 다른 특성을 가집니다.
- 리프노드만 index와 함께 데이터(Value)를 가지고 있고, 나머지 노드들은 데이터를 위한 index(Key)만을 갖습니다.
- 리프노드들은 LinkedList로 연결되어 있습니다.
- 데이터 노드 크기는 index 노드의 크기와 같지 않아도 됩니다.

데이터베이스의 index 컬럼은 부등호를 이용한 순차 검색 연산이 자주 발생합니다. 이 때문에 B-Tree의 리프노드들을 LinkedList로 연결하여 순차검색을 용이하게 하는 등 B-Tree를 인덱스에 맞게 최적화 하였습니다.

물론 리프노드까지 가지 않아도 탐색할 수 있는 B-Tree에 비해 무조건 리프노드까지 가야한다는 단점도 있습니다.

이러한 이유로 B+Tree는 O(𝑙𝑜𝑔2𝑛) 시간 복잡도를 가지지만 해시 테이블보다 index에 더욱 적합한 자료구조 입니다.

#### InnoDB B+Tree 구조
![mysql_innoDB_index.png](img/mysql_innoDB_index.png)

InnoDB의 B+Tree는 일반적인 구조보다 더욱 복잡하게 구현이 되어있습니다. InnoDB에서 같은 레벨의 노드들끼리는 LinkedList가 아닌 DoubleLinkedList로 연결되어있으며, 자식 노드들은 SingleLinkedList로 연결되어 있습니다.
