# 2장 개략적인 규모 추정

보편적으로 통용되는 성능 수치상의 사고 실험을 통해 추정치를 계산하는 행위

### 2의 제곱수

- 2^10 : 1킬로바이트(KB)
- 2^20 : 1메가바이트(MB)
- 2^30 : 1기가바이트(GB)
- 2^40 : 1테라바이트(TB)
- 2^50 : 1페타바이트(PB)

### 응답지연 값

| **연산명**                        | **시간**                |
|--------------------------------|-----------------------|
| L1 캐시 참조                       | 0.5ns                 |
| 분기 예측 오류(branch mispredict)    | 5ns                   |
| L2 캐시 참조                       | 7ns                   |
| 뮤텍스 락/언락                       | 100ns                 |
| 주 메모리 참조                       | 100ns                 |
| Zippy로 1KB 압축                  | 10,000ns = 10us       |
| 1Gbps 네트워크로 2KB 전송             | 20,000ns = 20us       |
| 메모리에서 1MB 순차적으로 read           | 250,000ns = 250us     |
| 같은 데이터 센터 내에서 메시지 왕복 지연시간      | 500,000ns = 500us     |
| 디스크 탐색                         | 10,000,000ns = 10ms   |
| 네트워크에서 1MB 순차적으로 read          | 10,000,000ns = 10ms   |
| 디스크에서 1MB 순차적으로 read           | 30,000,000ns = 30ms   |
| 한 패킷의 캘리포니아로부터 네델란드까지의 왕복 지연시간 | 150,000,000ns = 150ms |


- 메모리는 빠르지만 디스크는 아직도 느리다.
- 디스크 탐색은 가능한 한 피하라.
- 단순한 압축 알고리즘은 빠르다.
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라.
- 데이터 센터는 보통 여러 지역(region)에 분산되어 있고, 센터들 간에 데이터를 주고받는 데는 시간이 걸린다.

### 가용성에 관계된 수치들

고가용성은 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력

| **가용률** |**하루당 장애시간**|**주당 장애시간**|**개월당 장애시간**|연간 장애시간**|
|---------|--|--|--|--|
| 99%     |14.40분|1.68시간|7.31시간|3.65일|
|99.9%|1.44분|10.08분|43.83분|8.77시간|
|99.99%|8.64초|1.01분|4.38분|52.60분|
|99.999%|864.00밀리초|6.05초|26.30초|5.26분|
|99.9999%|86.40밀리초|604.80밀리초|2.63초|31.56초|

### QPS 추정

#### 요구사항 가정

- 월간 능동 사용자(monthly active user)는 3억명이다.
- 50%의 사용자가 매일 사용한다.
- 평균적으로 각 사용자는 매일 2건의 게시물을 올린다.
- 미디어를 포함하는 게시물은 10% 정도다.
- 데이터는 5년간 보관된다.

#### QPS 추정치

- 일간 능동 사용자(Daily Active User, DAU) = 3억 x 50% = 1.5억
- QPS = 1.5억 x 2 게시물 / 24시간 / 3600초 = 약 3500
- 최대 QPS = 2 x QPS = 약 7000
- 미디어 저장소 요구량 : 1.5억 x 2 x 10% x 1MB = 30TB/일
- 5년간 미디어를 보관하기 위한 저장소 요구량 : 30쓔 x 365 x 5 = 약 55PB

### 팁

- 근사치를 활용한 계산
- 가정은 적어 두라. 나중에 볼 수 있다.
- 단위를 붙여라.
- 많이 출제되는 개략적 규모 추정 문제는
  - QPS
  - 최대 QPS
  - 저장소 요구량
  - 캐시 요구량
  - 서버 수 등
